<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–õ–∏—á–Ω—ã–π AI-–¥–∏–∑–∞–π–Ω–µ—Ä</title>

  <style>
    :root { --primary:#2f7cff; --bg:#f5f5f5; }
    * { box-sizing:border-box; }
    body { font-family: Arial, sans-serif; margin:0; background:var(--bg); color:#111; }
    header { padding:18px 14px; text-align:center; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.06); }
    h1 { margin:0 0 8px; font-size:22px; }
    .wrap { max-width:1040px; margin:18px auto 34px; padding:0 14px; }

    /* —Ñ–æ—Ä–º–∞ */
    .row { display:flex; gap:10px; align-items:center; }
    @media (max-width:700px){ .row{ flex-direction:column; align-items:stretch; } }
    #prompt {
      width:100%; padding:12px 14px; border:1px solid #ddd; border-radius:8px; font-size:16px;
      background:#fff;
    }
    .btn {
      padding:12px 18px; border:0; border-radius:8px; background:var(--primary); color:#fff;
      font-weight:600; cursor:pointer;
    }
    .btn:disabled { opacity:.6; cursor:not-allowed; }

    /* —Å–µ—Ç–∫–∞ —Å—Ç–∏–ª–µ–π */
    .styles-grid{
      display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
      gap:14px; margin:16px auto; max-width:980px;
    }
    .style-btn{
      border:0; padding:0; background:#fff; border-radius:10px;
      box-shadow:0 1px 3px rgba(0,0,0,.08); cursor:pointer; overflow:hidden;
      outline:2px solid transparent; transition:.15s ease;
    }
    .style-btn img{ display:block; width:100%; height:140px; object-fit:cover; }
    .style-btn span{ display:block; font-size:12px; padding:6px 8px; color:#333; text-align:center; }
    .style-btn.selected{ outline-color:var(--primary); outline-offset:2px; }

    /* —Ä–µ–∑—É–ª—å—Ç–∞—Ç */
    #result { margin-top:22px; text-align:center; }
    #result img { max-width:100%; border-radius:12px; box-shadow:0 4px 18px rgba(0,0,0,.12); }
    #hint { font-size:12px; color:#666; margin-top:6px; }
  </style>
</head>
<body>
  <header>
    <h1>üé® –õ–∏—á–Ω—ã–π AI-–¥–∏–∑–∞–π–Ω–µ—Ä</h1>
    <div style="font-size:13px;color:#555">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–ø—Ç –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å-—Å—Ç–∏–ª—å</div>
  </header>

  <main class="wrap">
    <!-- —Ñ–æ—Ä–º–∞ -->
    <div class="row">
      <input id="prompt" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ—Ä—Ç—Ä–µ—Ç –¥–µ–≤—É—à–∫–∏ –≤ –∫—Ä–∞—Å–Ω–æ–º –ø–ª–∞—Ç—å–µ —É –º–æ—Ä—è, –∑–∞–∫–∞—Ç, 85mm" />
      <button class="btn" id="genBtn" onclick="sendPrompt()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <!-- —Å–µ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤ (19 —à—Ç—É–∫) -->
    <div id="styles" class="styles-grid">
      <button class="style-btn" data-ref="style01.jpg"><img src="styles/style01.jpg" alt="style01"><span>Style 01</span></button>
      <button class="style-btn" data-ref="style02.jpg"><img src="styles/style02.jpg" alt="style02"><span>Style 02</span></button>
      <button class="style-btn" data-ref="style03.jpg"><img src="styles/style03.jpg" alt="style03"><span>Style 03</span></button>
      <button class="style-btn" data-ref="style04.jpg"><img src="styles/style04.jpg" alt="style04"><span>Style 04</span></button>
      <button class="style-btn" data-ref="style05.jpg"><img src="styles/style05.jpg" alt="style05"><span>Style 05</span></button>
      <button class="style-btn" data-ref="style06.jpg"><img src="styles/style06.jpg" alt="style06"><span>Style 06</span></button>
      <button class="style-btn" data-ref="style07.jpg"><img src="styles/style07.jpg" alt="style07"><span>Style 07</span></button>
      <button class="style-btn" data-ref="style08.jpg"><img src="styles/style08.jpg" alt="style08"><span>Style 08</span></button>
      <button class="style-btn" data-ref="style09.jpg"><img src="styles/style09.jpg" alt="style09"><span>Style 09</span></button>
      <button class="style-btn" data-ref="style10.jpg"><img src="styles/style10.jpg" alt="style10"><span>Style 10</span></button>
      <button class="style-btn" data-ref="style11.jpg"><img src="styles/style11.jpg" alt="style11"><span>Style 11</span></button>
      <button class="style-btn" data-ref="style12.jpg"><img src="styles/style12.jpg" alt="style12"><span>Style 12</span></button>
      <button class="style-btn" data-ref="style13.jpg"><img src="styles/style13.jpg" alt="style13"><span>Style 13</span></button>
      <button class="style-btn" data-ref="style14.jpg"><img src="styles/style14.jpg" alt="style14"><span>Style 14</span></button>
      <button class="style-btn" data-ref="style15.jpg"><img src="styles/style15.jpg" alt="style15"><span>Style 15</span></button>
      <button class="style-btn" data-ref="style16.jpg"><img src="styles/style16.jpg" alt="style16"><span>Style 16</span></button>
      <button class="style-btn" data-ref="style17.jpg"><img src="styles/style17.jpg" alt="style17"><span>Style 17</span></button>
      <button class="style-btn" data-ref="style18.jpg"><img src="styles/style18.jpg" alt="style18"><span>Style 18</span></button>
      <button class="style-btn" data-ref="style19.jpg"><img src="styles/style19.jpg" alt="style19"><span>Style 19</span></button>
    </div>

    <!-- –º–µ—Å—Ç–æ –ø–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="result"></div>
    <div id="hint"></div>
  </main>

  <script>
    // –≤—ã–±–æ—Ä —Å—Ç–∏–ª—è
    let selectedRef = null;
    document.querySelectorAll('.style-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.style-btn').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedRef = btn.dataset.ref; // –Ω–∞–ø—Ä–∏–º–µ—Ä "style07.jpg"
        document.getElementById('hint').textContent = '–í—ã–±—Ä–∞–Ω —Å—Ç–∏–ª—å: ' + selectedRef;
      });
    });

    // –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    async function sendPrompt(){
      const promptEl = document.getElementById('prompt');
      const btn = document.getElementById('genBtn');
      const box = document.getElementById('result');

      const prompt = (promptEl.value || '').trim();
      if(!prompt){ alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–ø—Ç.'); promptEl.focus(); return; }
      if(!selectedRef){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å-—Å—Ç–∏–ª—å.'); return; }

      btn.disabled = true; btn.textContent = '–ì–µ–Ω–µ—Ä–∏—Ä—É—é‚Ä¶';
      box.innerHTML = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è‚Ä¶';

      try{
        const res = await fetch('/api/generate', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ prompt, reference: selectedRef })
        });
        const data = await res.json();

        if(data.imageUrl){
          box.innerHTML = `<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <img src="${data.imageUrl}" alt="result">`;
        }else{
          throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        }
      }catch(e){
        console.error(e);
        box.innerHTML = '–û—à–∏–±–∫–∞: ' + e.message;
        alert('–û—à–∏–±–∫–∞: ' + e.message);
      }finally{
        btn.disabled = false; btn.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å';
      }
    }
  </script>
</body>
</html>
