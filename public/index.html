<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Image Generator</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container">
    <h1>AI Image Generator</h1>

    <!-- Ввод и селекторы -->
    <div class="row">
      <input id="prompt" placeholder="Введите описание..." />
      <select id="styleSelect" class="select">
        <!-- 19 стилей (названия для пользователя) -->
        <option value="Boho-Sunset">Boho Sunset</option>
        <option value="Calm-Interior">Calm Interior</option>
        <option value="Cherry-Gloss">Cherry Gloss</option>
        <option value="Christal-Shine">Christal Shine</option>
        <option value="Cinematic-Noir">Cinematic Noir</option>
        <option value="Crystal-Spark">Crystal Spark</option>
        <option value="Dark-Velvet">Dark Velvet</option>
        <option value="Golden-Fantasy">Golden Fantasy</option>
        <option value="Golden-Sparkle">Golden Sparkle</option>
        <option value="Ivory-Light">Ivory Light</option>
        <option value="Midnight-Glam">Midnight Glam</option>
        <option value="Neon-Dreams">Neon Dreams</option>
        <option value="Pastel-Glow">Pastel Glow</option>
        <option value="Retro-Wave">Retro Wave</option>
        <option value="Silver-Glow">Silver Glow</option>
        <option value="Soft-Bloom">Soft Bloom</option>
        <option value="Surrealism">Surrealism</option>
        <option value="Urban-Chic">Urban Chic</option>
        <option value="Vintage-Dust">Vintage Dust</option>
      </select>

      <select id="sizeSelect" class="select">
        <option value="1024x1024">Square (1:1)</option>
        <option value="1024x1792">Portrait (9:16)</option>
        <option value="1792x1024">Landscape (16:9)</option>
      </select>

      <button id="generate" class="primary">Сгенерировать</button>
    </div>

    <!-- Сетка карточек со всеми 19 превью -->
    <div class="styles-grid" id="stylesGrid">
      <!-- Карточки создадим скриптом, чтобы не дублировать разметку -->
    </div>

    <!-- Ответ сервера (текст) -->
    <pre id="log" class="log"></pre>

    <!-- Результат -->
    <div id="resultWrap" class="result hidden">
      <img id="resultImg" alt="result" />
    </div>
  </div>

  <script>
    // === Конфигурация всех 19 стилей (имя файла + подпись) ===
    const STYLES = [
      { key: "Boho-Sunset",    label: "Boho Sunset"    },
      { key: "Calm-Interior",  label: "Calm Interior"  },
      { key: "Cherry-Gloss",   label: "Cherry Gloss"   },
      { key: "Christal-Shine", label: "Christal Shine" },
      { key: "Cinematic-Noir", label: "Cinematic Noir" },
      { key: "Crystal-Spark",  label: "Crystal Spark"  },
      { key: "Dark-Velvet",    label: "Dark Velvet"    },
      { key: "Golden-Fantasy", label: "Golden Fantasy" },
      { key: "Golden-Sparkle", label: "Golden Sparkle" },
      { key: "Ivory-Light",    label: "Ivory Light"    },
      { key: "Midnight-Glam",  label: "Midnight Glam"  },
      { key: "Neon-Dreams",    label: "Neon Dreams"    },
      { key: "Pastel-Glow",    label: "Pastel Glow"    },
      { key: "Retro-Wave",     label: "Retro Wave"     },
      { key: "Silver-Glow",    label: "Silver Glow"    },
      { key: "Soft-Bloom",     label: "Soft Bloom"     },
      { key: "Surrealism",     label: "Surrealism"     },
      { key: "Urban-Chic",     label: "Urban Chic"     },
      { key: "Vintage-Dust",   label: "Vintage Dust"   },
    ];

    const grid = document.getElementById("stylesGrid");
    const styleSelect = document.getElementById("styleSelect");

    // Создаём карточки превью (квадратные, берем из /public/styles/*.jpg)
    STYLES.forEach(({ key, label }, idx) => {
      const card = document.createElement("button");
      card.type = "button";
      card.className = "style-card";
      card.dataset.key = key;
      card.innerHTML = `
        <div class="thumb"><img src="/styles/${key}.jpg" alt="${label}" loading="lazy"/></div>
        <div class="style-title">${label}</div>
      `;
      card.addEventListener("click", () => {
        // визуально выделим выбранную
        document.querySelectorAll(".style-card.selected").forEach(el => el.classList.remove("selected"));
        card.classList.add("selected");
        // синхронизируем с селектом
        styleSelect.value = key;
      });
      if (idx === 0) card.classList.add("selected");
      grid.appendChild(card);
    });

    // При смене в селекте — подсветим соответствующую карточку
    styleSelect.addEventListener("change", () => {
      const value = styleSelect.value;
      document.querySelectorAll(".style-card").forEach(el => {
        el.classList.toggle("selected", el.dataset.key === value);
      });
    });

    const btn = document.getElementById("generate");
    const promptInput = document.getElementById("prompt");
    const sizeSelect = document.getElementById("sizeSelect");
    const log = document.getElementById("log");
    const resultWrap = document.getElementById("resultWrap");
    const resultImg = document.getElementById("resultImg");

    function setBusy(isBusy) {
      btn.disabled = isBusy;
      btn.textContent = isBusy ? "Генерирую…" : "Сгенерировать";
    }

    btn.addEventListener("click", async () => {
      const prompt = (promptInput.value || "").trim();
      const style = styleSelect.value;
      const size  = sizeSelect.value;

      if (!prompt) {
        alert("Введите описание (prompt).");
        return;
      }

      setBusy(true);
      log.textContent = "";
      resultWrap.classList.add("hidden");
      resultImg.src = "";

      try {
        const res = await fetch("/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, style, size })
        });

        const text = await res.text();
        log.textContent = `HTTP ${res.status}\n` + text;

        // Попробуем достать data:image… из ответа
        const m = text.match(/"image"\s*:\s*"([^"]+)"/);
        if (m && m[1].startsWith("data:image")) {
          resultImg.src = m[1];
          // выставим класс по соотношению сторон
          resultImg.classList.remove("ratio-1-1","ratio-9-16","ratio-16-9");
          if (size === "1024x1024") resultImg.classList.add("ratio-1-1");
          else if (size === "1024x1792") resultImg.classList.add("ratio-9-16");
          else resultImg.classList.add("ratio-16-9");
          resultWrap.classList.remove("hidden");
        }
      } catch (e) {
        log.textContent = "Ошибка: " + e.message;
      } finally {
        setBusy(false);
      }
    });
  </script>
</body>
</html>
