<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Image Generator</title>
  <link rel="stylesheet" href="/styles.css" />
  <meta name="theme-color" content="#3761ff" />
  <style>
    /* Небольшой локальный стиль для шапки/подвала (остальное — в styles.css) */
    .header { padding: 8px 0 4px; }
    .footer { opacity:.7; font-size:12px; margin-top:12px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>AI Image Generator</h1>
    </div>

    <!-- Панель управления -->
    <div class="controls">
      <input id="prompt" type="text" placeholder="Введите описание..." />
      <select id="sizeSelect">
        <option value="square">Square (1:1)</option>
        <option value="portrait">Portrait (9:16)</option>
        <option value="landscape">Landscape (16:9)</option>
      </select>
      <button id="generateBtn" class="primary" onclick="generate()">Сгенерировать</button>
    </div>

    <!-- Сетка стилей (рендерится скриптом) -->
    <div id="stylesGrid" class="styles-grid"></div>

    <!-- Статус и результат -->
    <pre id="status" style="display:none"></pre>

    <div class="output">
      <img id="out" alt="Результат появится здесь" />
    </div>

    <div class="footer">Выберите стиль (клик по карточке), задайте размер, введите промпт и нажмите «Сгенерировать».</div>
  </div>

  <script>
    // ====== ДАННЫЕ СТИЛЕЙ (19 штук) ======
    const STYLES = [
      { title: "Boho Sunset",     file: "Boho-Sunset.jpg"     },
      { title: "Calm Interior",   file: "Calm-Interior.jpg"   },
      { title: "Cherry Gloss",    file: "Cherry-Gloss.jpg"    },
      { title: "Christal Shine",  file: "Christal-Shine.jpg"  },
      { title: "Cinematic Noir",  file: "Cinematic-Noir.jpg"  },
      { title: "Crystal Spark",   file: "Crystal-Spark.jpg"   },
      { title: "Dark Velvet",     file: "Dark-Velvet.jpg"     },
      { title: "Golden Fantasy",  file: "Golden-Fantasy.jpg"  },
      { title: "Golden Sparkle",  file: "Golden-Sparkle.jpg"  },
      { title: "Ivory Light",     file: "Ivory-Light.jpg"     },
      { title: "Midnight Glam",   file: "Midnight-Glam.jpg"   },
      { title: "Neon Dreams",     file: "Neon-Dreams.jpg"     },
      { title: "Pastel Glow",     file: "Pastel-Glow.jpg"     },
      { title: "Retro Wave",      file: "Retro-Wave.jpg"      },
      { title: "Silver Glow",     file: "Silver-Glow.jpg"     },
      { title: "Soft Bloom",      file: "Soft-Bloom.jpg"      },
      { title: "Surrealism",      file: "Surrealism.jpg"      },
      { title: "Urban Chic",      file: "Urban-Chic.jpg"      },
      { title: "Vintage Dust",    file: "Vintage-Dust.jpg"    }
    ];

    // выбранный заголовок стиля
    let selectedTitle = STYLES[0].title;

    // ====== РЕНДЕРИМ СЕТКУ СТИЛЕЙ ======
    const grid = document.getElementById("stylesGrid");

    function renderStyles() {
      grid.innerHTML = "";
      STYLES.forEach(style => {
        const card = document.createElement("div");
        card.className = "style-card" + (style.title === selectedTitle ? " selected" : "");
        card.dataset.title = style.title;

        const img = document.createElement("img");
        img.loading = "lazy";
        img.alt = style.title;
        img.src = `/styles/${style.file}`;

        const caption = document.createElement("div");
        caption.className = "title";
        caption.textContent = style.title;

        card.appendChild(img);
        card.appendChild(caption);

        card.addEventListener("click", () => {
          selectedTitle = style.title;
          // визуально помечаем выбранную
          document.querySelectorAll(".style-card").forEach(el => el.classList.remove("selected"));
          card.classList.add("selected");
        });

        grid.appendChild(card);
      });
    }
    renderStyles();

    // ====== ГЕНЕРАЦИЯ ======
    async function generate() {
      const btn = document.getElementById("generateBtn");
      const prompt = document.getElementById("prompt").value.trim();
      const aspect = document.getElementById("sizeSelect").value; // square | portrait | landscape
      const status = document.getElementById("status");
      status.style.display = "block";
      status.textContent = "Генерация...";

      btn.disabled = true;

      try {
        const payload = {
          prompt,
          styleLabel: selectedTitle,
          aspect // сервер сам решит, куда слать: OpenAI (1:1) или Replicate (9:16/16:9)
        };

        const r = await fetch("/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await r.json();
        status.textContent = `HTTP ${r.status}\n` + JSON.stringify(data, null, 2);

        if (data.image) {
          const out = document.getElementById("out");
          out.src = data.image;
          // Автоскролл к результату
          out.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      } catch (e) {
        status.textContent = "Ошибка: " + (e?.message || e);
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
